<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#111111"/>
  <title>Tarot Drawer</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    :root { --fg:#111; --bg:#fafafa; --muted:#6b7280; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg); color:var(--fg); }
    .wrap { max-width:860px; margin:0 auto; padding:16px; }
    h1 { font-size:22px; margin:0 0 8px; }
    .hint { color:var(--muted); font-size:14px; margin:0 0 12px; }
    .card { margin:12px 0 16px; padding:16px; border:1px solid #e5e7eb; border-radius:12px; background:#fff; }
    .draw { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    button, select { border:1px solid #111; background:#111; color:#fff; padding:10px 14px; border-radius:10px; font-size:15px; }
    select { background:#fff; color:#111; border-color:#ccc; }

    .imageBox { text-align:center; margin-top:10px; }
    .imageBox a { display:inline-block; }
    .imageBox img {
      max-width:100%;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
    }

    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:8px; margin-top:10px; }
    .item { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:10px; }
    .row { display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .site { font-size:12px; color:#555; }
    #current a { font-weight:600; }
    #current .siteNow { margin-left:8px; font-size:12px; color:#555; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Tarot Drawer</h1>
    <p class="hint">Draw a card when ready.</p>

    <div class="card">
      <div class="draw">
        <button id="drawBtn">Draw</button>
        <select id="sitePick">
          <option value="tarotcom">Tarot.com</option>
          <option value="biddy">Biddy Tarot</option>
          <option value="labyrinthos">Labyrinthos</option>
          <option value="keen">Keen</option>
        </select>
        <div id="current">
          <a id="currentLink">Draw a card</a>
          <span class="siteNow" id="currentSite"></span>
          <span id="currentArcana"></span>
        </div>
      </div>

      <div class="imageBox">
        <a id="imageLink">
          <img id="cardImage" src="images/back.jpg" alt="Card image"/>
        </a>
      </div>
    </div>

    <div class="card">
      <h2>Reference</h2>
      <div class="grid" id="list"></div>
    </div>
  </div>

<script>
const majors = [
  "The Fool","The Magician","The High Priestess","The Empress","The Emperor","The Hierophant","The Lovers","The Chariot",
  "Strength","The Hermit","Wheel of Fortune","Justice","The Hanged Man","Death","Temperance","The Devil",
  "The Tower","The Star","The Moon","The Sun","Judgement","The World"
];

const ranks = ["Ace","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Page","Knight","Queen","King"];
const suits = ["Wands","Cups","Swords","Pentacles"];

function buildDeck(){
  const deck = [];
  majors.forEach(name => deck.push({ name, arcana:"Major Arcana" }));
  suits.forEach(suit => ranks.forEach(rank => deck.push({
    name: `${rank} of ${suit}`,
    arcana:"Minor Arcana"
  })));
  return deck;
}
const deck = buildDeck();

const slugify = s => s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
const imagePath = name => `images/${slugify(name)}.jpg`;

const siteBuilders = {
  tarotcom: {
    label: "Tarot.com",
    url: card => `https://www.tarot.com/tarot/cards/${slugify(card.name.replace("Pentacles","Coins"))}`
  },
  biddy: {
    label: "Biddy Tarot",
    url(card){
      if (card.arcana === "Major Arcana"){
        return `https://biddytarot.com/tarot-card-meanings/major-arcana/${slugify(card.name.replace(/^The /,''))}/`;
      }
      const [rank, suit] = card.name.split(" of ");
      return `https://biddytarot.com/tarot-card-meanings/minor-arcana/suit-of-${slugify(suit)}/${slugify(rank)}-of-${slugify(suit)}/`;
    }
  },
  labyrinthos: {
    label: "Labyrinthos",
    url: card => `https://labyrinthos.co/blogs/tarot-card-meanings-list/${slugify(card.name)}-meaning-tarot-card-meanings`
  },
  keen: {
    label: "Keen",
    url: card => `https://www.keen.com/articles/tarot/${slugify(card.name)}-tarot-card`
  }
};

const list = document.getElementById('list');
const drawBtn = document.getElementById('drawBtn');
const currentLink = document.getElementById('currentLink');
const currentSite = document.getElementById('currentSite');
const currentArcana = document.getElementById('currentArcana');
const sitePick = document.getElementById('sitePick');
const cardImage = document.getElementById('cardImage');
const imageLink = document.getElementById('imageLink');

let lastCard = null;

function renderList(){
  list.innerHTML = "";
  deck.forEach(card => {
    const site = sitePick.value;
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `<div class="row">
        <a href="${siteBuilders[site].url(card)}" target="_blank">${card.name}</a>
        <span class="site">${siteBuilders[site].label}</span>
      </div>`;
    list.appendChild(div);
  });
}

function updateCurrent(){
  if (!lastCard) return;

  const site = sitePick.value;
  const url = siteBuilders[site].url(lastCard);

  currentLink.textContent = lastCard.name;
  currentLink.href = url;
  currentLink.target = "_blank";

  imageLink.href = url;
  imageLink.target = "_blank";

  currentSite.textContent = `(${siteBuilders[site].label})`;
  currentArcana.textContent = ` â€” ${lastCard.arcana}`;

  const img = imagePath(lastCard.name);
  cardImage.onerror = () => cardImage.src = "images/back.jpg";
  cardImage.src = img;
}

function draw(){
  lastCard = deck[Math.floor(Math.random()*deck.length)];
  updateCurrent();
}

sitePick.addEventListener('change', () => { renderList(); updateCurrent(); });
drawBtn.addEventListener('click', draw);

renderList();

if ('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>
</body>
</html>
